<div id="title" align="center">
    <h1>Track</h1>
</div>

<div id="badges" align="center">
    你说🔥，你的修行还未结束。
</div>


## Table of Contents

+ [2020-5-25](#2020-5-25)


## 2020-5-25

​	觉得自己的成长速度不太够，不知道是太贪心的缘故，还是最近变颓废了，所以开了这个坑，记录每天的成长经历。

​	第一天自然不能摸了，由于以前对数据库的读写性能没有太大自信，于是今天索性测试了一下`mysql`读写性能。就跑在在之前搭的`kubernetes`集群下（🥀每错单机`minikube`版本）。用`go`+`gorm`编写的测试程序, 进行大批量数据插入和查询操作。

​	在CPU：`G2030 @3.00GHz`、内存：`12G`、`mysql:5.7`。

  **插入性能**

| 插入数据(条) | 用户态耗时(秒) | 系统耗时(秒) | 真实时间(秒) |
| ------------ | -------------- | ------------ | ------------ |
| 10           | 0.013          | 0.004        | 0.091        |
| 100          | 0.015          | 0.036        | 0.230        |
| 1000         | 0.136          | 0.301        | 1.924        |
| 10000        | 1.685          | 2.611        | 21.665       |

  **主键查询性能**

| 查询量(条) | 数据量 | 用户态耗时(秒) | 系统耗时(秒) | 真实时间(秒) |
| ---------- | ------   | -------------- | ------------ | ------------ |
| 100        | 10000    | 0.009         | 0.017       | 0.052       |
| 100        | 100000   | 0.012     | 0.015    | 0.046    |
| 100        | 1000000  | 0.011        | 0.046      | 0.046     |
|  | 1000000 | 0.367 | 0.256 | 1.035 |

**非主键查询**

| 查询量(条) | 数据量 | 用户态耗时(秒) | 系统耗时(秒) | 真实时间(秒) |
| ---------- | ------   | -------------- | ------------ | ------------ |
| 100        | 10000  | 0.009      | 0.019 | 0.091        |
| 100       | 100000  | 0.016      | 0.015   | 0.078    |
| 100      | 1000000  | 0.008        | 0.023       | 0.080        |
| 1000 | 1000000 | 0.111 | 0.130 | 1.029        |

**总结：**

+ 插入数据的性能消耗远远大于查询性能的消耗。

+ 该配置环境下，插入1000条数据耗时大概2s，10w数据量非主键查询1s达到1000条，按照主键查询1s达到4000条。
+ 主键查询时间复杂度大概o( log(n) ), 非主键查询大概O(n)。

+ 所以查询时优先使用主键查询，而且插入比查询耗时高很多(与硬盘速度有关)，通常瓶颈点在 IO > 写数据 > 读数据。